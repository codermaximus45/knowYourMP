<!DOCTYPE html>
<meta charset = "utf=8">
<head>
</head>
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.js"></script>
  <script>

        //Set width and height
        var w = 700;
        var h = 700;

        //Set d3 projection, path, svg and a color scale
        var projection = d3.geo.mercator()
            .center([90, 27.5])
            .scale(1200);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("body")
          .append("svg")
          .attr("width", w)
          .attr("height",h);

        var color = d3.scale.quantize()
            .range(["rgb(254,224,210)", "rgb(252,187,161)", "rgb(252,146,114)", "rgb(251,106,74)", "rgb(239,59,44)", "rgb(203,24,29)", "rgb(165,15,21)", "rgb(103,0,13)"]);

        //Open csv dataset
        d3.csv("data/affidavits.csv", function(error, data) {

          //dynamically compute the domain of color scale
          color.domain([0, 25]);

          d3.json("maps/india.json", function(error, pc) {
            if (error) return console.error(error);

            var india = topojson.feature(pc, pc.objects.india_pc_2014);

            for(var i = 0; i < data.length; i++) {

              var dataPC = data[i].Constituency;
              var dataValue = data[i].CriminalCase;

              for(var j = 0; j < india.features.length; j++) {
                var PCname = india.features[j].properties.PC_NAME;

                if(PCname == null) { continue; }
                else if(dataPC.toLowerCase() == PCname.toLowerCase()) {
                  india.features[j].properties.CriminalCase = dataValue;
                  break;
                }
              }
            }

            svg.selectAll("path")
               .data(india.features)
               .enter()
               .append("path")
               .attr("d", path)
               .style("fill", function(d) {
                   var value = d.properties.CriminalCase;

                   if (value) { return color(value); }
                   else if (d.properties.PC_NAME == null) { return "#999"; }
                   else { return "#ccc"; }
               });
          });
        });
/*
        d3.json("maps/india.json", function(error, india) {
          var subunits = topojson.feature(india, india.objects.india_pc_2014);
          svg.append("path")
              .datum(subunits)
              .attr("d", path)
              .attr("fill", "#cdc");
        });
*/
  </script>
</body>
</html>
